# GitHub Pages + エックスサーバー 独自ドメイン設定手順書

GitHub PagesのWebアプリケーションに、エックスサーバーで取得したサブドメインを設定する手順です。

## 前提条件
- GitHub Pagesでサイトが公開済み
- エックスサーバーでドメインまたはサブドメインを管理
- 設定予定のドメイン例: `survey.example.com`

## 手順1: エックスサーバーでのDNS設定

### 1.1 サーバーパネルにログイン
1. [エックスサーバー サーバーパネル](https://www.xserver.ne.jp/login_server.php)にログイン
2. 対象ドメインのサーバーパネルを開く

### 1.2 DNS設定
1. **「DNS設定」**をクリック
2. **「DNSレコード追加」**タブを選択
3. 以下の設定でレコードを追加：

#### Aレコードの設定（推奨）
```
種別: A
ホスト名: survey（サブドメインの部分）
内容: 185.199.108.153
優先度: 0
```

**GitHub Pages用IPアドレス（2024年現在）:**
- `185.199.108.153`
- `185.199.109.153`
- `185.199.110.153`
- `185.199.111.153`

**複数のAレコードを追加（冗長化のため）:**
```
A survey 185.199.108.153
A survey 185.199.109.153
A survey 185.199.110.153
A survey 185.199.111.153
```

#### CNAMEレコードの設定（代替案）
```
種別: CNAME
ホスト名: survey
内容: kurocofficial.github.io
優先度: 0
```

### 1.3 設定確認
4. **「確認画面へ進む」**をクリック
5. 内容を確認して**「追加する」**をクリック

## 手順2: GitHubでの独自ドメイン設定

### 2.1 リポジトリ設定
1. GitHubで`kuroco_aiuse_survey`リポジトリを開く
2. **「Settings」**タブをクリック
3. 左サイドバーから**「Pages」**を選択

### 2.2 カスタムドメイン設定
4. **「Custom domain」**の入力欄に設定したいドメインを入力
   ```
   survey.example.com
   ```
5. **「Save」**をクリック
6. **「Enforce HTTPS」**にチェックを入れる（数分後に有効になる）

### 2.3 CNAMEファイルの自動作成確認
7. リポジトリのルートディレクトリに`CNAME`ファイルが自動作成されることを確認
8. ファイル内容がドメイン名と一致していることを確認

## 手順3: SSL証明書の設定

### 3.1 GitHub側での自動SSL
- GitHubが自動的にLet's Encrypt証明書を発行
- 設定後15分〜1時間程度で有効になる
- 「Enforce HTTPS」オプションが有効になるまで待つ

### 3.2 確認方法
```bash
# DNS設定の確認
nslookup survey.example.com

# HTTPS接続の確認
curl -I https://survey.example.com
```

## 手順4: 動作確認

### 4.1 DNS伝播の確認
1. [DNS Checker](https://dnschecker.org/)でDNS伝播を確認
2. 全世界でAレコードが正しく設定されていることを確認

### 4.2 サイトアクセス確認
3. ブラウザで`https://survey.example.com`にアクセス
4. アンケートフォームが正常に表示されることを確認
5. フォーム送信機能のテスト

### 4.3 リダイレクト確認
6. `http://survey.example.com`が`https://`に自動リダイレクトされることを確認

## 手順5: 必要に応じた設定ファイル更新

### 5.1 Google Apps Script設定
独自ドメインを使用する場合、CORS設定は既に`*`で全ドメイン許可済みのため変更不要。

### 5.2 README.mdの更新
```markdown
**アンケートフォーム**: https://survey.example.com
```

## トラブルシューティング

### DNS設定が反映されない
- **原因**: DNS伝播に時間がかかる（最大48時間）
- **対処**: 時間をおいて再確認、キャッシュクリア

### HTTPS証明書エラー
- **原因**: DNS設定未完了、GitHub側の証明書発行待ち
- **対処**: DNS確認後、GitHub Pagesの「Enforce HTTPS」を再設定

### 404エラーが表示される
- **原因**: CNAMEファイルの設定ミス、GitHub Pages設定ミス
- **対処**: リポジトリのCNAMEファイル内容確認、Pages設定再確認

### エックスサーバー特有の注意点
- **TTL値**: デフォルトは3600秒（1時間）
- **ワイルドカード**: `*.example.com`での一括設定も可能
- **サブドメイン制限**: エックスサーバーのプランによって制限あり

## 確認コマンド集

```bash
# DNS設定確認
dig survey.example.com A
dig survey.example.com CNAME

# SSL証明書確認
openssl s_client -connect survey.example.com:443 -servername survey.example.com

# HTTPSリダイレクト確認
curl -I http://survey.example.com
```

## 設定完了後のメンテナンス

- **GitHub Pages**: 自動更新、メンテナンス不要
- **DNS設定**: 基本的に変更不要
- **SSL証明書**: Let's Encryptが自動更新
- **ドメイン更新**: エックスサーバーでの年次更新のみ

## セキュリティ考慮事項

- **HTTPS強制**: 必ず「Enforce HTTPS」を有効化
- **HSTS**: GitHub Pagesが自動設定
- **CSP**: 必要に応じてHTMLにContent Security Policyを追加

---

**注意**: IP アドレスは変更される可能性があります。最新情報は[GitHub Pages公式ドキュメント](https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site)を確認してください。